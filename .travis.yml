dist: xenial
sudo: false
language: python

python:
- 2.7
- 3.6
- &latest_py3 3.7

jobs:
  fast_finish: true
  include:
  - stage: deploy
    if: tag IS present
    python: *latest_py3
    before_script: skip
    env:
    - TWINE_USERNAME=jaraco
    # TWINE_PASSWORD
    - secure: XTdQzOWDoG2inl0HYGEG/Q/drq/Q4an6f8j68B60yYkwBkBVQegBvPhxESBR1le5P6aY9M5ocrnZqmy3orVdRiRMDYEXstbUhC6tz5GIXN3qLU0svTnKZFqrtqFNCkkSG+FkRaf/zPvrQC+I/wQHTOKOvQq7FE9sq4s7T3J+aOxfTgLKHIvfc2HEEEnyoLsvs9ojuy8AZ7icnxa6hucCVn8KrAJfatg7xM2s4Fdc2Vor79qt6ecgZZAk3IgL9piu0RZVWwfj9ZnLzA3cIwuhc+9fd7mDYOQ2fA5l8KQD5Y+Q9jh0nM1kV1gERLlTVJ2zHXpD+9UoQKqLSpH80h5Q/X9JOIUVmJqlQLa4ZoPbbB1IhkanI3sJc38ebh161cbjOUpL5OjHeU2GVuzz8e4bo4ghvnfBwW05FJmNNNZXbC6X1DHuE8wCg5Rn8d8N0C4+wydP/Gabb14H9DaUjamPLJNoQgMJ5MXOqRFA2mq6mO154PkCPjUj+wguV4Mwk8D2wH+D8nuDJ2CNFIt4xC3LuIjzo0P6Y7juyJhfykp/oWt3pjwsap4KnoHjXdUf6XfaOuJiW9umeXyo2EErIxuTd6wZtNuCi/oqZu5xhLD5colKrzqepLDkv6t7aaykhzGXvbzB1p1lpP826PZ5UElXnJTMAB/J4iq2t0GESiC+/5g=
    - TOX_TESTENV_PASSENV="TWINE_USERNAME TWINE_PASSWORD"
    script: tox -e release

cache: pip

install:
- pip install tox tox-venv

before_script:
  # Disable IPv6. Ref travis-ci/travis-ci#8361
  - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then
      sudo sh -c 'echo 0 > /proc/sys/net/ipv6/conf/all/disable_ipv6';
    fi
script: tox
